<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Lead authors: Seow Ryan, Jensie Low   Collaborator: Derek Yuen   Corresponding author: Dr.&nbsp;Linda Sellou">

<title>Theme 3: Water &amp; Oceans</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="Chapter4_files/libs/clipboard/clipboard.min.js"></script>
<script src="Chapter4_files/libs/quarto-html/quarto.js"></script>
<script src="Chapter4_files/libs/quarto-html/popper.min.js"></script>
<script src="Chapter4_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Chapter4_files/libs/quarto-html/anchor.min.js"></script>
<link href="Chapter4_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Chapter4_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Chapter4_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Chapter4_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Chapter4_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview">1 | OVERVIEW</a></li>
  <li><a href="#sdg-6-clean-water-and-sanitation" id="toc-sdg-6-clean-water-and-sanitation" class="nav-link" data-scroll-target="#sdg-6-clean-water-and-sanitation">2 | SDG 6: CLEAN WATER AND SANITATION</a></li>
  <li><a href="#detection-quantification-methods" id="toc-detection-quantification-methods" class="nav-link" data-scroll-target="#detection-quantification-methods">3 | DETECTION &amp; QUANTIFICATION METHODS</a></li>
  <li><a href="#electrochemistry" id="toc-electrochemistry" class="nav-link" data-scroll-target="#electrochemistry">4 | ELECTROCHEMISTRY</a></li>
  <li><a href="#deliverables" id="toc-deliverables" class="nav-link" data-scroll-target="#deliverables">5 | DELIVERABLES</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">6 | REFERENCES</a></li>
  <li><a href="#further-readings" id="toc-further-readings" class="nav-link" data-scroll-target="#further-readings">7 | FURTHER READINGS</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Theme 3: Water &amp; Oceans</h1>
<p class="subtitle lead">Water Treatment Methods</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Lead authors: Seow Ryan, Jensie Low <br> Collaborator: Derek Yuen <br> Corresponding author: Dr.&nbsp;Linda Sellou </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="overview" class="level2">
<h2 class="anchored" data-anchor-id="overview">1 | OVERVIEW</h2>
<section id="learning-objectives" class="level4">
<h4 class="anchored" data-anchor-id="learning-objectives">LEARNING OBJECTIVES</h4>
<ul>
<li>Discuss about pollution and water treatment methods</li>
<li>Understand basic calibration methods for detection and quantification</li>
<li>Able to apply concepts in basic electrochemistry in water treatment</li>
</ul>
</section>
</section>
<section id="sdg-6-clean-water-and-sanitation" class="level2">
<h2 class="anchored" data-anchor-id="sdg-6-clean-water-and-sanitation">2 | SDG 6: CLEAN WATER AND SANITATION</h2>
<p style="text-align: justify;">
Goal 6 of the United National Sustainable Development Goals is to ensure access to water and sanitation for all. Evidently, from the COVID-19 pandemic, clean hygiene is very important to prevent the spread of pathogens. As well, there are many other pollutants to get rid of to obtain safe water. In this section, we will be discussing methods to test water quality and methods to treat water.
</p>
<p style="text-align: justify;">
Singapore has four national taps, three of which are methods to ensure self-sustainability in an integrated water system. The NEWater Process (<strong>Figure 1</strong>) is one of the water treatment methods to recycle used water back into potable water, and uses three simple processes of filtration, reverse osmosis, and UV disinfection.
</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Chapter4Media\Fig1.jpg" title="NEWater Technology (Image : PUB Singapore)" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption"><strong>Figure 1.</strong> NEWater Technology (Image : PUB Singapore)</figcaption>
</figure>
</div>
<blockquote class="blockquote">
<p><strong>Discussion corner</strong></p>
<p style="text-align: justify;">
What causes pollution? What are the categories of pollutants? What kinds of treatment methods are used for a specific pollutant?
</p>
</blockquote>
</section>
<section id="detection-quantification-methods" class="level2">
<h2 class="anchored" data-anchor-id="detection-quantification-methods">3 | DETECTION &amp; QUANTIFICATION METHODS</h2>
<p style="text-align: justify;">
The Public Utilities Board (PUB) Singapore tests water samples collected from reservoirs, water works, and water distribution systems around the island at the PUB’s Water Quality Laboratory. More than 500 000 of such tests are conducted annually to ensure that the water quality remains within safe drinking standards that is regulated by the Environmental Public Health (EPH) Water Suitable for Drinking Regulation.
</p>
<section id="standard-calibration" class="level4">
<h4 class="anchored" data-anchor-id="standard-calibration">3.1 STANDARD CALIBRATION</h4>
<div class="callout callout-style-default callout-tip no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example: Total Phosphorous Amounts
</div>
</div>
<div class="callout-body-container callout-body">
<p style="text-align: justify;">
One of the components tested in water is phosphorous. Total Phosphorous (P) levels should fall within the range of 0.003 – 0.42 mg/L in the water samples. This is important because phosphorous is widely used in fertilisers, pesticides, and detergents. When these compounds (e.g.&nbsp;phosphides, phosphates) leech into local water bodies as agricultural runoff or residential wastewater, it can lead to eutrophication.
</p>
<p style="text-align: justify;">
One way to measure phosphorous concentration in an unknown sample is by using samples with known concentrations to obtain a calibration curve of signal vs concentration. Since phosphorous samples are generally colourless, colourimetric analysis needs to be done through the addition of a colour reagent.
</p>
<p style="text-align: justify;">
Ammonium molybdate, (NH<span class="math inline">\(_4\)</span>)<span class="math inline">\(_2\)</span>MoS<span class="math inline">\(_4\)</span>, is added to obtain a phosphomolybdate, (NH<span class="math inline">\(_4\)</span>)<span class="math inline">\(_3\)</span>OMo<span class="math inline">\(_{12}\)</span>O<span class="math inline">\(_{40}\)</span>. Ascorbic acid is then added to reduce the complex to form molybdenum blue, a dark blue complex. As a result, the intensity of blue can be said to be directly proportional to the concentration of phosphate content (and hence a measure of Total Phosphorous). The absorbance is measured with UV-vis spectroscopy at 880 nm for a series of standard solutions of phosphates. (Data taken from Shimadzu Applications No.&nbsp;A354)
</p>
</div>
</div>
<p><strong>Table 1.</strong> Absorbance values at 880 nm for standard solutions of phosphorous. <img src="Chapter4Media\Table1.png" title="Table 1. Absorbance values at 880 nm for standard solutions of phosphorous." class="img-fluid" style="width:80.0%"></p>
<blockquote class="blockquote">
<p><strong>Discussion corner</strong></p>
<p>Using any software, plot a calibration curve and determine the value of [P] and its uncertainty. Does this fall within the range of stated by EPH Regulations?</p>
</blockquote>
</section>
<section id="limitations-of-analytical-methods" class="level4">
<h4 class="anchored" data-anchor-id="limitations-of-analytical-methods">3.2 LIMITATIONS OF ANALYTICAL METHODS</h4>
<p style="text-align: justify;">
All analytical methods have their advantages, disadvantages, and their limits. While looking at the advantages of a particular method can help us better select it, it is also important to recognise its limitations (e.g.&nbsp;resolution limits of microscopes, wavelength sensitivity of spectroscopic methods).
</p>
<p style="text-align: justify;">
One way to test the limits of the calibration curve is by calculating the limits of detection (LoD) and limits of quantification (LoQ). This is also widely used in pharmaceuticals or in clinical laboratory. <strong>LoD</strong> is the lowest concentration of analyte that can be detected by the method that is distinguishable from zero (blank). <strong>LoQ</strong> is the lowest concentration of analyte that can be quantified with reasonable accuracy and repeatability. These two values are useful in determining if your method is suitable.
</p>
<p><strong>Table 2.</strong> Formula and rationale behind LoD and LoQ calculations. <img src="Chapter4Media\Table2.png" title="Table 2. Formula and rationale behind LoD and LoQ calculations." class="img-fluid" style="width:80.0%"></p>
<blockquote class="blockquote">
<p><strong>Discussion corner</strong></p>
<p>Using the calibration curve from the last discussion corner, determine the LoD and LoQ.</p>
</blockquote>
</section>
<section id="extra-calibration-methods-for-interested-students" class="level4">
<h4 class="anchored" data-anchor-id="extra-calibration-methods-for-interested-students">3.3 EXTRA CALIBRATION METHODS (FOR INTERESTED STUDENTS)</h4>
<p style="text-align: justify;">
The method used above is known as <strong>external calibration</strong>. This is because we use <strong>standard solutions</strong> that are separate from the unknown / test sample. The advantage of this method lies in its simplicity and hence versatility. By knowing the substance we are testing, we can create standard solutions, plot a curve, and infer values from it. However, because this method is simple, it can be affected by complex systems (e.g.&nbsp;wastewater) where other components influence measurements.
</p>
<section id="a-internal-standard" class="level5">
<h5 class="anchored" data-anchor-id="a-internal-standard">(A) Internal Standard</h5>
<p style="text-align: justify;">
The internal standard calibration method is useful to overcome systematic and random error. In this method, a substance, similar in nature to that of the analyte, is added in a known volume to the blank, standards and samples. However, this method is also tedious as more time is required for sample preparation as well as data analysis. Furthermore, this method requires an analyte similar to that of the sample which may not always be readily available.
</p>
<p style="text-align: justify;">
The signal of the response produced now becomes the ratio of the analyte signal to the reference signal. <strong>Figure 2</strong> shows how the signals or data obtained can be used to evaluate the desired concentration of the unknown sample from the internal standard.
</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Chapter4Media\Figure2.png" title="Signal comparison of unknown sample versus internal standard" class="img-fluid figure-img" style="width:50.0%"></p>
<figcaption class="figure-caption"><strong>Figure 2.</strong> Signal comparison of unknown sample versus internal standard)</figcaption>
</figure>
</div>
</section>
<section id="b-standard-addition" class="level5">
<h5 class="anchored" data-anchor-id="b-standard-addition">(B) Standard Addition</h5>
<p style="text-align: justify;">
Standard addition is another method where standard solutions of known concentration are added to the unknown solution before back-extrapolating to determine the original concentration. This way, <em>a known volume and concentration is spiked into the sample solution.</em>
</p>
<p style="text-align: justify;">
Standard addition is useful in overcoming the matrix effect (which usually occurs in samples with multiple components, such as wastewater). However, this method is also more tedious than external calibration and assumes linearity in the negative x-axis.
</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Chapter4Media\Figure3.png" title="Sample graph used for back-extrapolation in standard addition" class="img-fluid figure-img" style="width:60.0%"></p>
<figcaption class="figure-caption"><strong>Figure 3.</strong> Sample graph used for back-extrapolation in standard addition</figcaption>
</figure>
</div>
<p style="text-align: justify;">
From <strong>Figure 3</strong>, a calibration curve can still be plot based on the known concentration and volume of the standard solution added to the sample. Back-extrapolation is done to determine the actual concentration in the sample.
</p>
<div class="callout callout-style-default callout-tip no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Mathematical Proof (for motivated and interested students)
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><img src="Chapter4Media\Figure4.png" class="img-fluid" style="width:80.0%"></p>
<p>where</p>
<ul>
<li>X = unknown concentration of analyte<br>
</li>
<li>S = known concentration of standard<br>
</li>
<li><em>i</em> = initial (before addition of standard)<br>
</li>
<li><em>f</em> = final (after addition of standard)</li>
</ul>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="electrochemistry" class="level2">
<h2 class="anchored" data-anchor-id="electrochemistry">4 | ELECTROCHEMISTRY</h2>
<p style="text-align: justify;">
Electrochemical reactions are derived from the interconversion between electrical energy and chemical potential energy that arises from redox reactions. A simple example can be found in rechargeable batteries (e.g.&nbsp;Li-ion batteries).
</p>
<p><strong>Table 3.</strong> Electrochemical reaction in rechargeable batteries <img src="Chapter4Media\Table3.png" class="img-fluid" style="width:100.0%"></p>
<section id="voltage" class="level4">
<h4 class="anchored" data-anchor-id="voltage">4.1 VOLTAGE</h4>
<p style="text-align: justify;">
Voltage (V) is the potential energy per unit charge and can be evaluated as the <strong>potential difference between the electrodes</strong>. If the potential difference between the cathode and the anode is <strong>positive</strong>, this means that the reaction will occur <strong>spontaneously without the need for an external source of energy</strong>. An example of this is in the <strong>sacrificial protection of steel</strong>, where more electrochemically active aluminium is attached to the hull of ships to delay the time taken for steel to corrode.
</p>
<p><strong>Table 4.</strong> Electrochemical reaction in the sacrificial protection of steel <img src="Chapter4Media\Table4.png" class="img-fluid" style="width:100.0%"></p>
<p style="text-align: justify;">
As a result, any iron corroded (oxidised) by seawater will have its oxidation “reversed” as the aluminium is “sacrificed” in the process.
</p>
</section>
<section id="current" class="level4">
<h4 class="anchored" data-anchor-id="current">4.2 CURRENT</h4>
<p style="text-align: justify;">
When charging a battery, <strong>how long should you charge it for?</strong> When you switch on your electrical appliances, a <strong>current is supplied</strong>. Current (I, A) is the amount of charge (Q, C) moving per unit time (<em>t</em>, s). The amount of charge is also proportional to the amount of electrons (n<span class="math inline">\(_e\)</span>, mol) exchanging in the redox system. The proportionality constant is also known as the Faraday constant (96485 C/mol).
</p>
<p><span class="math display">\[\begin{equation}
Q = It = n_eF
\end{equation}\]</span></p>
<blockquote class="blockquote">
<p><strong>Discussion corner</strong></p>
<p style="text-align: justify;">
What is the mass of copper deposited when 0.7 A of current is supplied for 3 h for an electrochemical set-up with two copper electrodes immersed in 0.50 M H<span class="math inline">\(_2\)</span>SO<span class="math inline">\(_4\)</span> ?
</p>
</blockquote>
</section>
</section>
<section id="deliverables" class="level2">
<h2 class="anchored" data-anchor-id="deliverables">5 | DELIVERABLES</h2>
<p style="text-align: justify;">
In this second part of this theme, the basic science that you should have taken away is:
</p>
<ul>
<li>Calibration methods and limitations of analytical methods</li>
<li>Basic electrochemistry and redox reactions</li>
</ul>
<p style="text-align: justify;">
The content in this handout will be sufficient to <strong>plan</strong> and <strong>understand</strong> what needs to be done for this experiment on electrocoagulation.
</p>
<section id="lab-worksheet" class="level4">
<h4 class="anchored" data-anchor-id="lab-worksheet">Lab Session</h4>
<p style="text-align: justify;">
You will find a copy of the lab worksheet in the Google Classroom. You are required to:
</p>
<ul>
<li>Read the background and general procedure</li>
<li>Plan your experiment <strong>with your group BEFORE your lab session</strong> (discuss with mentor)</li>
<li>Update your lab journal <strong>WITHIN ONE WEEK AFTER your lab session</strong></li>
<li>Refer to lab worksheet for more detailed instructions</li>
</ul>
</section>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">6 | REFERENCES</h2>
<p><em>Acknowledgements for <strong>Figures</strong> and <strong>Data</strong></em></p>
<ul>
<li><strong>Figure 1</strong> (PUB, NEWater Technology) <a href="https://www.pub.gov.sg/watersupply/fournationaltaps/newater">here</a></li>
<li>Data for <strong>Table 1</strong> <a href="https://www.shimadzu.com/an/sites/shimadzu.com.an/files/pim/pim_document_file/applications/application_note/13503/a354.pdf">here</a></li>
</ul>
</section>
<section id="further-readings" class="level2">
<h2 class="anchored" data-anchor-id="further-readings">7 | FURTHER READINGS</h2>
<p style="text-align: justify;">
You may look to these sources for inspiration regarding your individual presentation or to supplement your own learning.
</p>
<ul>
<li><a href="https://www.sciencedaily.com/releases/2022/06/220623153704.html"><strong>Microplastic pollution and its effects</strong></a></li>
<li><strong>What are the impacts of plastic pollution on the climate, oceans and biodiversity? Are current measures enough?</strong> [Derek’s (Ong) Individual Presentation]</li>
<li><a href="https://www.intechopen.com/chapters/62471"><strong>Phosphorous Eutrophication</strong></a></li>
<li><a href="https://www.electrochem.org/the-science-of-how-lead-pipes-poison-your-water"><strong>Lead Pipes</strong></a></li>
<li><a href="https://www.eurekalert.org/news-releases/932207"><strong>Electrocoagulation</strong></a> (relevant to lab !)</li>
</ul>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>
